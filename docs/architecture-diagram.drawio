<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/28.0.6 Chrome/138.0.7204.100 Electron/37.2.3 Safari/537.36" version="28.0.6">
  <diagram name="Microsoft Marketplace Quota Architecture" id="architecture">
    <mxGraphModel dx="1189" dy="819" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" value="Microsoft Marketplace Quota Management System" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#2F5F8F;" parent="1" vertex="1">
          <mxGeometry x="350" y="20" width="470" height="30" as="geometry" />
        </mxCell>
        <mxCell id="external-box" value="External Systems" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="40" y="80" width="280" height="200" as="geometry" />
        </mxCell>
        <mxCell id="teams" value="Microsoft Teams" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#0078d4;fillColor=#e1f5fe;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="marketplace" value="Microsoft&#xa;Commercial Marketplace" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#ff6d00;fillColor=#fff3e0;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="180" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="partner-center" value="Partner Center" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#e65100;fillColor=#fff3e0;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="200" y="180" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="apim-box" value="Azure API Management (APIM)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="380" y="80" width="300" height="120" as="geometry" />
        </mxCell>
        <mxCell id="apim-quota" value="Quota Policy&#xa;(300 requests/month)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976d2;fillColor=#e3f2fd;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="400" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="apim-rate" value="Rate Limiting&#xa;&amp; Throttling" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976d2;fillColor=#e3f2fd;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="540" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="app-box" value="GPT-4.1 Chatbot Application" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2e7d32;fillColor=#e8f5e8;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="40" y="320" width="640" height="280" as="geometry" />
        </mxCell>
        <mxCell id="bot-framework" value="Microsoft Bot Framework&#xa;(Teams AI Library)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#388e3c;fillColor=#c8e6c9;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="360" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="quota-middleware" value="Quota Usage&#xa;Middleware" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#f57c00;fillColor=#fff8e1;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="360" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="express" value="Express.js Server&#xa;(Node.js)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#388e3c;fillColor=#c8e6c9;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="360" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="openai" value="Azure OpenAI&#xa;GPT-4" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#0078d4;fillColor=#e1f5fe;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="510" y="360" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="services-box" value="Services Layer" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=14;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="60" y="480" width="550" height="80" as="geometry" />
        </mxCell>
        <mxCell id="subscription-service" value="Subscription&#xa;Service" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#7b1fa2;fillColor=#f3e5f5;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="80" y="510" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="metering-client" value="Marketplace&#xa;Metering Client" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#d32f2f;fillColor=#ffebee;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="180" y="510" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="audit-logger" value="Audit&#xa;Logger" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#5d4037;fillColor=#efebe9;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="300" y="510" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="auth-utils" value="Auth &amp;&#xa;Security Utils" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#e65100;fillColor=#fff3e0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="390" y="510" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="error-handler" value="Error&#xa;Handler" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#c62828;fillColor=#ffebee;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="500" y="510" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="database-box" value="Database Layer" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#efebe9;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="40" y="640" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="postgresql" value="PostgreSQL&#xa;Database" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1565c0;fillColor=#e3f2fd;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="680" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tables" value="Tables:&#xa;• subscriptions&#xa;• usage_events&#xa;• audit_logs" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#616161;fillColor=#f5f5f5;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="190" y="680" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="monitoring-box" value="Monitoring &amp; Observability" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#e65100;fillColor=#fff3e0;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="400" y="640" width="280" height="120" as="geometry" />
        </mxCell>
        <mxCell id="app-insights" value="Application Insights" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976d2;fillColor=#e3f2fd;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="420" y="680" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="azure-storage" value="Azure Storage&#xa;(Failed Events)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#689f38;fillColor=#f1f8e9;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="560" y="680" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="flow1" value="User Messages" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#0078d4;" parent="1" source="teams" target="apim-quota" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow2" value="Authorized Requests" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#2e7d32;" parent="1" source="apim-quota" target="quota-middleware" edge="1">
          <mxGeometry x="-0.55" y="50" relative="1" as="geometry">
            <mxPoint x="460" y="240" as="sourcePoint" />
            <mxPoint x="280" y="320" as="targetPoint" />
            <Array as="points">
              <mxPoint x="480" y="300" />
              <mxPoint x="280" y="300" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow3" value="Processed Messages" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#388e3c;" parent="1" source="quota-middleware" target="bot-framework" edge="1">
          <mxGeometry x="0.2" y="-35" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow4" value="AI Requests" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#0078d4;" parent="1" source="bot-framework" target="openai" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="385" as="sourcePoint" />
            <mxPoint x="510" y="385" as="targetPoint" />
            <Array as="points">
              <mxPoint x="130" y="440" />
              <mxPoint x="560" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="flow5" value="Fulfillment Webhooks" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#ff6d00;" parent="1" source="marketplace" target="express" edge="1">
          <mxGeometry x="0.3" y="10" relative="1" as="geometry">
            <mxPoint x="120" y="240" as="sourcePoint" />
            <mxPoint x="420" y="320" as="targetPoint" />
            <Array as="points">
              <mxPoint x="150" y="270" />
              <mxPoint x="420" y="270" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow6" value="Usage Events" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#d32f2f;dashed=1;" parent="1" source="metering-client" target="marketplace" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="230" y="470" as="sourcePoint" />
            <mxPoint x="120" y="240" as="targetPoint" />
            <Array as="points">
              <mxPoint x="230" y="460" />
              <mxPoint x="50" y="460" />
              <mxPoint x="50" y="350" />
              <mxPoint x="120" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="flow7" value="Data Persistence" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#795548;" parent="1" source="subscription-service" target="postgresql" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="120" y="520" as="sourcePoint" />
            <mxPoint x="110" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow8" value="Telemetry" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#e65100;dashed=1;" parent="1" source="audit-logger" target="app-insights" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="335" y="520" as="sourcePoint" />
            <mxPoint x="480" y="640" as="targetPoint" />
            <Array as="points">
              <mxPoint x="335" y="580" />
              <mxPoint x="480" y="580" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-box" value="Legend" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#333333;fillColor=#f8f9fa;fontSize=14;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="720" y="80" width="200" height="200" as="geometry" />
        </mxCell>
        <mxCell id="legend-external" value="External Systems" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="740" y="110" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-apim" value="Azure API Management" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976d2;fillColor=#e3f2fd;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="740" y="140" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-app" value="Application Components" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2e7d32;fillColor=#e8f5e8;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="740" y="170" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-db" value="Database &amp; Storage" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#efebe9;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="740" y="200" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-monitor" value="Monitoring &amp; Observability" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#e65100;fillColor=#fff3e0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="740" y="230" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="features-box" value="Key Features" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#333333;fillColor=#f8f9fa;fontSize=14;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="720" y="320" width="200" height="180" as="geometry" />
        </mxCell>
        <mxCell id="feature1" value="✅ 300 questions/month quota" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="730" y="350" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="feature2" value="✅ Real-time quota enforcement" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="730" y="370" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="feature3" value="✅ Marketplace billing integration" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="730" y="390" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="feature4" value="✅ Subscription management" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="730" y="410" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="feature5" value="✅ Usage events tracking" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="730" y="430" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="feature6" value="✅ Comprehensive audit logging" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="730" y="450" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="feature7" value="✅ Error handling &amp; retry logic" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="730" y="470" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="version-info" value="Version: v1.1.0-step1-dependencies&#xa;Date: August 17, 2025&#xa;Status: Dependencies ✅ Complete" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="720" y="780" width="200" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
