<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/28.0.6 Chrome/138.0.7204.100 Electron/37.2.3 Safari/537.36" version="28.0.6">
  <diagram name="Complete Architecture - Client to Infrastructure" id="complete-architecture">
    <mxGraphModel dx="1600" dy="1100" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="ChatBottez GPT-4.1 - Architecture ComplÃ¨te Client-to-Infrastructure" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#0078D4;" parent="1" vertex="1">
          <mxGeometry x="400" y="10" width="800" height="40" as="geometry" />
        </mxCell>
        
        <!-- Client Layer -->
        <mxCell id="client-layer" value="Client Layer - Microsoft Teams Users" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#0078D4;fillColor=#E1F5FE;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="70" width="1500" height="120" as="geometry" />
        </mxCell>
        
        <!-- Teams Desktop -->
        <mxCell id="teams-desktop" value="Microsoft Teams&#xa;Desktop Client" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="110" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Teams Web -->
        <mxCell id="teams-web" value="Microsoft Teams&#xa;Web Client" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="270" y="110" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Teams Mobile -->
        <mxCell id="teams-mobile" value="Microsoft Teams&#xa;Mobile App" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="110" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- User Personas -->
        <mxCell id="user-personas" value="ðŸ‘¥ User Personas:&#xa;â€¢ Enterprise Users&#xa;â€¢ Developers&#xa;â€¢ Business Analysts&#xa;â€¢ Content Creators&#xa;&#xa;ðŸ’¬ Chat Experience:&#xa;â€¢ Natural language queries&#xa;â€¢ 300 questions/month quota&#xa;â€¢ Real-time responses&#xa;â€¢ Quota status feedback" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#F1F8E9;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="620" y="100" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- Marketplace Integration -->
        <mxCell id="marketplace-integration" value="ðŸª Microsoft Commercial Marketplace:&#xa;â€¢ SaaS Subscription Model&#xa;â€¢ 300 questions/month plan&#xa;â€¢ Automated billing&#xa;â€¢ License management&#xa;â€¢ Usage tracking" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF6D00;fillColor=#FFF3E0;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="850" y="100" width="220" height="80" as="geometry" />
        </mxCell>
        
        <!-- Partner Center -->
        <mxCell id="partner-center" value="Partner Center&#xa;â€¢ Offer Management&#xa;â€¢ Billing Configuration&#xa;â€¢ Analytics Dashboard&#xa;â€¢ Customer Management" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#E65100;fillColor=#FFF3E0;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1100" y="100" width="180" height="80" as="geometry" />
        </mxCell>
        
        <!-- Teams Admin -->
        <mxCell id="teams-admin" value="Teams Admin Center&#xa;â€¢ App Deployment&#xa;â€¢ Permissions&#xa;â€¢ Policies" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#9C27B0;fillColor=#F3E5F5;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1310" y="100" width="130" height="80" as="geometry" />
        </mxCell>
        
        <!-- Application Layer -->
        <mxCell id="app-layer" value="Application Layer - ChatBottez GPT-4.1 Bot" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2E7D32;fillColor=#E8F5E8;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="220" width="1500" height="200" as="geometry" />
        </mxCell>
        
        <!-- Bot Framework -->
        <mxCell id="bot-framework" value="Microsoft Bot Framework&#xa;Teams AI Library" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#388E3C;fillColor=#C8E6C9;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="260" width="160" height="50" as="geometry" />
        </mxCell>
        
        <!-- Express.js Server -->
        <mxCell id="express-server" value="Express.js Server&#xa;Node.js Runtime&#xa;Port: 3978" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#388E3C;fillColor=#C8E6C9;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="100" y="330" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- Middleware Stack -->
        <mxCell id="middleware-stack" value="Middleware Stack:&#xa;&#xa;ðŸ›¡ï¸ Quota Usage Middleware&#xa;â€¢ Check remaining quota&#xa;â€¢ Track usage events&#xa;â€¢ Block over-quota requests&#xa;&#xa;ðŸ” Authentication Middleware&#xa;â€¢ Teams token validation&#xa;â€¢ Marketplace webhook auth&#xa;&#xa;ðŸ“Š Audit Logging Middleware&#xa;â€¢ Request/response logging&#xa;â€¢ Security event tracking" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF9800;fillColor=#FFF8E1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="290" y="260" width="200" height="130" as="geometry" />
        </mxCell>
        
        <!-- Business Logic -->
        <mxCell id="business-logic" value="Business Logic Services:&#xa;&#xa;ðŸŽ¯ Chat Processing Service&#xa;â€¢ Natural language understanding&#xa;â€¢ Context management&#xa;â€¢ Response generation&#xa;&#xa;ðŸ“Š Subscription Service&#xa;â€¢ User subscription lookup&#xa;â€¢ Quota management&#xa;â€¢ Usage tracking&#xa;&#xa;ðŸ”„ Metering Client&#xa;â€¢ Marketplace usage events&#xa;â€¢ Batch processing&#xa;â€¢ Retry logic" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="520" y="260" width="200" height="130" as="geometry" />
        </mxCell>
        
        <!-- API Endpoints -->
        <mxCell id="api-endpoints" value="API Endpoints:&#xa;&#xa;ðŸ“¨ /api/messages&#xa;â€¢ Teams bot messages&#xa;â€¢ Quota enforcement&#xa;&#xa;ðŸ”— Marketplace Webhooks:&#xa;â€¢ /marketplace/resolve&#xa;â€¢ /marketplace/{id}/activate&#xa;â€¢ /marketplace/{id}/update&#xa;â€¢ /marketplace/{id}/deactivate&#xa;&#xa;ðŸ” /health&#xa;â€¢ Health check endpoint" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#7B1FA2;fillColor=#F3E5F5;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="750" y="260" width="180" height="130" as="geometry" />
        </mxCell>
        
        <!-- Deployment -->
        <mxCell id="app-deployment" value="Deployment:&#xa;&#xa;â˜ï¸ Azure App Service&#xa;â€¢ Node.js 18+ runtime&#xa;â€¢ Auto-scaling enabled&#xa;â€¢ SSL certificates&#xa;&#xa;ðŸ³ Container Option&#xa;â€¢ Docker support&#xa;â€¢ Azure Container Apps&#xa;&#xa;ðŸ”§ Configuration:&#xa;â€¢ Environment variables&#xa;â€¢ Key Vault integration&#xa;â€¢ Application Insights" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#607D8B;fillColor=#ECEFF1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="960" y="260" width="180" height="130" as="geometry" />
        </mxCell>
        
        <!-- Teams Manifest -->
        <mxCell id="teams-manifest" value="Teams App Package:&#xa;&#xa;ðŸ“± App Manifest&#xa;â€¢ Bot capabilities&#xa;â€¢ Permissions&#xa;â€¢ Icons &amp; metadata&#xa;&#xa;ðŸ” App Registration&#xa;â€¢ Azure AD app&#xa;â€¢ Bot Framework registration&#xa;â€¢ OAuth permissions&#xa;&#xa;ðŸ“¦ Distribution&#xa;â€¢ App catalog&#xa;â€¢ Store submission&#xa;â€¢ Side-loading" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#EFEBE9;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1170" y="260" width="180" height="130" as="geometry" />
        </mxCell>
        
        <!-- AI Layer -->
        <mxCell id="ai-layer" value="AI &amp; Intelligence Layer" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#E65100;fillColor=#FFF3E0;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="450" width="1500" height="150" as="geometry" />
        </mxCell>
        
        <!-- Azure OpenAI -->
        <mxCell id="azure-openai" value="Azure OpenAI Service" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#F57C00;fillColor=#FFF8E1;fontSize=14;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="490" width="200" height="40" as="geometry" />
        </mxCell>
        
        <!-- GPT Models -->
        <mxCell id="gpt-models" value="GPT-4 Models:&#xa;â€¢ gpt-4 (latest)&#xa;â€¢ gpt-4-turbo&#xa;â€¢ Custom fine-tuned models" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF9800;fillColor=#FFF8E1;fontSize=11;align=left;" parent="1" vertex="1">
          <mxGeometry x="100" y="540" width="200" height="50" as="geometry" />
        </mxCell>
        
        <!-- AI Configuration -->
        <mxCell id="ai-config" value="AI Configuration:&#xa;&#xa;âš™ï¸ Model Parameters:&#xa;â€¢ Temperature: 0.7&#xa;â€¢ Max tokens: 2048&#xa;â€¢ System prompt loaded&#xa;&#xa;ðŸŽ¯ Prompt Engineering:&#xa;â€¢ Context injection&#xa;â€¢ Role-based prompts&#xa;â€¢ Response formatting&#xa;&#xa;ðŸ“Š Token Management:&#xa;â€¢ Cost optimization&#xa;â€¢ Usage tracking&#xa;â€¢ Rate limiting" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#F1F8E9;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="330" y="490" width="180" height="100" as="geometry" />
        </mxCell>
        
        <!-- Content Safety -->
        <mxCell id="content-safety" value="Content Safety:&#xa;&#xa;ðŸ›¡ï¸ Azure Content Safety&#xa;â€¢ Harmful content detection&#xa;â€¢ PII detection&#xa;â€¢ Content filtering&#xa;&#xa;ðŸ” Custom Filters:&#xa;â€¢ Business policy enforcement&#xa;â€¢ Compliance checking&#xa;â€¢ Brand safety" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#C62828;fillColor=#FFEBEE;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="540" y="490" width="160" height="100" as="geometry" />
        </mxCell>
        
        <!-- Vector Search -->
        <mxCell id="vector-search" value="Knowledge Base:&#xa;&#xa;ðŸ” Azure Cognitive Search&#xa;â€¢ Vector embeddings&#xa;â€¢ Semantic search&#xa;â€¢ Document indexing&#xa;&#xa;ðŸ“š Knowledge Sources:&#xa;â€¢ Company documents&#xa;â€¢ FAQs&#xa;â€¢ Product catalogs&#xa;â€¢ Technical docs" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="730" y="490" width="160" height="100" as="geometry" />
        </mxCell>
        
        <!-- LLM Analytics -->
        <mxCell id="llm-analytics" value="AI Analytics:&#xa;&#xa;ðŸ“Š Usage Analytics:&#xa;â€¢ Query patterns&#xa;â€¢ Response quality&#xa;â€¢ User satisfaction&#xa;&#xa;ðŸŽ¯ Model Performance:&#xa;â€¢ Latency monitoring&#xa;â€¢ Accuracy metrics&#xa;â€¢ Cost analysis&#xa;&#xa;ðŸ”„ Continuous Learning:&#xa;â€¢ Feedback loops&#xa;â€¢ Model updates&#xa;â€¢ A/B testing" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#9C27B0;fillColor=#F3E5F5;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="920" y="490" width="160" height="100" as="geometry" />
        </mxCell>
        
        <!-- API Management Layer -->
        <mxCell id="apim-layer" value="API Management &amp; Gateway Layer" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF5722;fillColor=#FFF3E0;fontSize=16;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="50" y="630" width="1500" height="120" as="geometry" />
        </mxCell>
        
        <!-- APIM Gateway -->
        <mxCell id="apim-gateway" value="Azure API Management&#xa;apim-chatbottez-gpt-4-1-dev-02" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#D84315;fillColor=#FFF3E0;fontSize=12;fontStyle=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="670" width="220" height="50" as="geometry" />
        </mxCell>
        
        <!-- Quota Policies -->
        <mxCell id="quota-policies" value="Quota Management:&#xa;&#xa;ðŸ“Š Policy Configuration:&#xa;â€¢ quota-by-key (subscription)&#xa;â€¢ 300 requests per month&#xa;â€¢ Rolling window reset&#xa;&#xa;ðŸš« Enforcement:&#xa;â€¢ HTTP 429 on exceeded&#xa;â€¢ Graceful degradation&#xa;â€¢ Usage headers returned" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="350" y="670" width="180" height="70" as="geometry" />
        </mxCell>
        
        <!-- Rate Limiting -->
        <mxCell id="rate-limiting" value="Rate Limiting:&#xa;&#xa;âš¡ Throttling Policies:&#xa;â€¢ 10 requests/minute&#xa;â€¢ Burst handling&#xa;â€¢ Circuit breaker&#xa;&#xa;ðŸ”§ Load Balancing:&#xa;â€¢ Multiple backend pools&#xa;â€¢ Health checks&#xa;â€¢ Failover logic" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF9800;fillColor=#FFF8E1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="560" y="670" width="160" height="70" as="geometry" />
        </mxCell>
        
        <!-- Security Policies -->
        <mxCell id="security-policies" value="Security Policies:&#xa;&#xa;ðŸ” Authentication:&#xa;â€¢ JWT validation&#xa;â€¢ API key management&#xa;â€¢ OAuth 2.0 flows&#xa;&#xa;ðŸ›¡ï¸ Protection:&#xa;â€¢ CORS policies&#xa;â€¢ IP filtering&#xa;â€¢ DDoS protection" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#7B1FA2;fillColor=#F3E5F5;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="750" y="670" width="160" height="70" as="geometry" />
        </mxCell>
        
        <!-- Analytics -->
        <mxCell id="apim-analytics" value="API Analytics:&#xa;&#xa;ðŸ“ˆ Usage Metrics:&#xa;â€¢ Request volume&#xa;â€¢ Response times&#xa;â€¢ Error rates&#xa;&#xa;ðŸ‘¥ User Analytics:&#xa;â€¢ Subscription usage&#xa;â€¢ Popular endpoints&#xa;â€¢ Geographic distribution" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#F1F8E9;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="940" y="670" width="160" height="70" as="geometry" />
        </mxCell>
        
        <!-- Infrastructure Layer (Reference to existing) -->
        <mxCell id="infra-layer" value="Infrastructure Layer (Azure Backend - See azure-infrastructure-diagram.drawio)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#EFEBE9;fontSize=16;fontStyle=1;verticalAlign=middle;dashed=1;dashPattern=5 5;" parent="1" vertex="1">
          <mxGeometry x="50" y="780" width="1500" height="60" as="geometry" />
        </mxCell>
        
        <!-- Data Flow Arrows -->
        
        <!-- Users to Bot -->
        <mxCell id="flow1" value="Chat Messages" style="endArrow=classic;html=1;rounded=0;strokeColor=#0078D4;strokeWidth=3;" parent="1" source="teams-desktop" target="bot-framework" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="300" as="sourcePoint" />
            <mxPoint x="450" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Bot to AI -->
        <mxCell id="flow2" value="AI Requests" style="endArrow=classic;html=1;rounded=0;strokeColor=#E65100;strokeWidth=3;" parent="1" source="business-logic" target="azure-openai" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="300" y="500" as="targetPoint" />
            <Array as="points">
              <mxPoint x="620" y="430" />
              <mxPoint x="200" y="430" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- APIM Flow -->
        <mxCell id="flow3" value="API Gateway" style="endArrow=classic;html=1;rounded=0;strokeColor=#FF5722;strokeWidth=2;" parent="1" source="apim-gateway" target="express-server" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="600" as="sourcePoint" />
            <mxPoint x="200" y="500" as="targetPoint" />
            <Array as="points">
              <mxPoint x="150" y="600" />
              <mxPoint x="150" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Marketplace Integration -->
        <mxCell id="flow4" value="Billing Events" style="endArrow=classic;html=1;rounded=0;strokeColor=#FF6D00;strokeWidth=2;dashed=1;" parent="1" source="business-logic" target="marketplace-integration" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="200" as="sourcePoint" />
            <mxPoint x="900" y="150" as="targetPoint" />
            <Array as="points">
              <mxPoint x="700" y="200" />
              <mxPoint x="900" y="200" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Legend Box -->
        <mxCell id="legend-box" value="Data Flow Legend" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#333333;fillColor=#F8F9FA;fontSize=12;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1130" y="670" width="200" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="legend1" value="â”€â”€â”€â”€ User Interactions" style="text;html=1;strokeColor=#0078D4;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="1140" y="690" width="180" height="10" as="geometry" />
        </mxCell>
        
        <mxCell id="legend2" value="â”€â”€â”€â”€ AI Processing" style="text;html=1;strokeColor=#E65100;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="1140" y="705" width="180" height="10" as="geometry" />
        </mxCell>
        
        <mxCell id="legend3" value="- - - - Billing Integration" style="text;html=1;strokeColor=#FF6D00;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="1140" y="720" width="180" height="10" as="geometry" />
        </mxCell>
        
        <!-- Status Info -->
        <mxCell id="status-info" value="Current Status: v1.6.0-step5-wsl-validation&#xa;âœ… Infrastructure Deployed&#xa;âš ï¸ Application Deployment Pending&#xa;âš ï¸ Azure OpenAI Configuration Needed&#xa;âš ï¸ Teams App Registration Required" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#37474F;fillColor=#ECEFF1;fontSize=10;align=left;" parent="1" vertex="1">
          <mxGeometry x="1360" y="670" width="180" height="70" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
